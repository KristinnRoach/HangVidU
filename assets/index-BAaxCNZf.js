(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const b=document.getElementById("localVideo"),f=document.getElementById("remoteVideo"),l=document.getElementById("sharedVideo"),S=document.getElementById("startChat"),V=document.getElementById("hangUp"),H=document.getElementById("copyLink"),D=document.getElementById("pipBtn"),Y=document.getElementById("switchCameraBtn"),M=document.getElementById("toggleMute"),F=document.getElementById("toggleVideo"),B=document.getElementById("toggleMode"),be=document.getElementById("loadStream"),ke=document.getElementById("status"),ae=document.getElementById("linkContainer"),re=document.getElementById("watchContainer"),se=document.querySelector(".video-container"),u=document.getElementById("syncStatus"),U=document.getElementById("shareLink"),w=document.getElementById("streamUrl"),oe=document.getElementById("mutePartnerBtn"),Re=document.getElementById("fullscreenPartnerBtn"),ce=document.getElementById("muteSelfBtn"),Te=document.getElementById("fullscreenSelfBtn"),X="hangvidu_session",Ie=1440*60*1e3;function Se(e){const t={...e,timestamp:Date.now()};localStorage.setItem(X,JSON.stringify(t))}function Le(){const e=localStorage.getItem(X);if(!e)return null;try{const t=JSON.parse(e);return Date.now()-t.timestamp>Ie?(_(),null):t}catch(t){return console.error("Failed to parse stored state:",t),_(),null}}function _(){localStorage.removeItem(X)}const De={apiKey:"AIzaSyA-fvCaKCjyEFX__YAVr1oPGdVsUEhFehA",authDomain:"vidu-aae11.firebaseapp.com",databaseURL:"https://vidu-aae11-default-rtdb.europe-west1.firebasedatabase.app",projectId:"vidu-aae11",storageBucket:"vidu-aae11.firebasestorage.app",messagingSenderId:"765724787439",appId:"1:765724787439:web:61a3b5dd538149564c911a",measurementId:"G-EGJ53HLGY4"};if(typeof firebase>"u")throw new Error("[firebase.js] Global firebase object is not defined! Make sure the Firebase CDN scripts are loaded before your app code runs.");firebase.apps.length||firebase.initializeApp(De);const m=firebase.database();function O(e,t,n){if(!e||!t)return;const i=`rooms/${e}/connections/${t}`;return m.ref(i).set({status:n,timestamp:Date.now()})}function Q(e,t,n){if(!e||!t)return null;const o=`rooms/${e}/connections/${t==="initiator"?"joiner":"initiator"}/status`,s=m.ref(o),c=p=>{p.val()==="reconnecting"&&n()};return s.on("value",c),()=>s.off("value",c)}async function xe(e,t){const n=m.ref(`rooms/${e}`);return await n.set({offer:{type:t.type,sdp:t.sdp}}),n}async function Be(e){const t=m.ref(`rooms/${e}`),n=await t.once("value");return{roomRef:t,roomSnapshot:n}}async function Oe(e){console.log("[ROOM-DEBUG] removeRoom called for roomId:",e,"at",new Date().toISOString()),await m.ref(`rooms/${e}`).remove()}function Ne(e,t){e.textContent=t}function Me(e,t,n){const i=e.getAudioTracks()[0];return i&&(n=!n,i.enabled=!n,t.textContent=n?"Unmute Mic":"Mute Mic"),n}function Fe(e,t,n){const i=e.getVideoTracks()[0];return i&&(n=!n,i.enabled=n,t.textContent=n?"Turn Video Off":"Turn Video On"),n}function Ue(e,t,n,i,o,s,c){return e=!e,e?(t.style.display="none",n.style.display="block",i.textContent="Switch to Video Chat",c.textContent="Paste the same stream URL as your partner"):(t.style.display="flex",n.style.display="none",i.textContent="Switch to Watch Mode",o.src="",s.value=""),e}function je({startChatBtn:e,hangUpBtn:t,copyLinkBtn:n,switchCameraBtn:i,toggleMuteBtn:o,toggleVideoBtn:s,toggleModeBtn:c,loadStreamBtn:p,pipBtn:C,remoteVideo:E,handleStartChat:q,handleHangUp:ye,handleCopyLink:Pe,handleToggleMute:we,handleToggleVideo:he,handleToggleMode:ve,handleLoadStream:Ce,handlePipToggle:ne,handleSwitchCamera:Ee,updateStatus:at}){document.addEventListener("keydown",G=>{G.altKey&&G.key==="p"&&E.srcObject&&(G.preventDefault(),ne())}),e.addEventListener("click",q),t.addEventListener("click",ye),n.addEventListener("click",Pe),i.addEventListener("click",Ee),o.addEventListener("click",we),s.addEventListener("click",he),c.addEventListener("click",ve),p.addEventListener("click",Ce),C.addEventListener("click",ne)}let d=null,I=!1,Ve=()=>!!document.pictureInPictureElement;async function Ae(e,t,n,i=!1){console.log("[PiP] Toggle requested",{hasDocumentPiP:"documentPictureInPicture"in window,hasStream:!!e.srcObject,hasFloatingWindow:!!document.pictureInPictureElement,documentPipWindowOpen:!!d,nativePipActive:Ve()});try{if(!e.srcObject){console.warn("[PiP] No remote stream available"),n("Connect to a partner first");return}if(document.pictureInPictureElement){console.log("[PiP] Exiting active native PiP (via custom button)"),await document.exitPictureInPicture(),I=!1,t.textContent="Float Partner Video";return}if(d){console.log("[PiP] Closing existing Document PiP window"),d.close(),d=null,t.textContent="Float Partner Video";return}if(e.offsetParent===null&&!("documentPictureInPicture"in window)){console.warn("[PiP] Video is hidden and Document PiP not available"),n("Switch to Video Chat mode to use floating window");return}if(i&&"documentPictureInPicture"in window){await $e(e,t);return}if("pictureInPictureEnabled"in document){await qe(e,t);return}}catch(o){console.error("[PiP] Error:",o.name,o.message,o),o.name==="NotAllowedError"?n("Picture-in-Picture blocked. Check browser permissions."):o.name==="InvalidStateError"?n("Cannot open PiP - video not ready"):n("Picture-in-Picture failed. See console for details.")}}async function $e(e,t){console.log("[PiP] Opening Document PiP window");try{if(d=await window.documentPictureInPicture.requestWindow({width:400,height:300}),console.log("[PiP] Document PiP window created",{width:d.innerWidth,height:d.innerHeight,closed:d.closed}),d.closed)throw console.error("[PiP] Window was closed immediately after creation"),d=null,new Error("PiP window closed immediately");[...document.styleSheets].forEach(p=>{try{const C=[...p.cssRules].map(q=>q.cssText).join(""),E=document.createElement("style");E.textContent=C,d.document.head.appendChild(E)}catch{const E=document.createElement("link");E.rel="stylesheet",E.href=p.href,d.document.head.appendChild(E)}}),d.document.body.innerHTML=`
    <div style="display: flex; flex-direction: column; height: 100vh; background: #1a1a1a;">
      <video id="pipVideo" autoplay muted playsinline style="flex: 1; width: 100%; background: #000;"></video>
      <button id="pipMute" style="padding: 10px; background: #ff9800; color: white; border: none; cursor: pointer; font-size: 14px;">
        Unmute Partner
      </button>
    </div>
  `;const n=d.document.getElementById("pipVideo"),i=d.document.getElementById("pipMute"),o=e.srcObject.getVideoTracks(),s=e.srcObject.getAudioTracks();console.log("[PiP] Stream tracks:",{video:o.length,audio:s.length,videoActive:o[0]?.enabled,audioActive:s[0]?.enabled}),n.srcObject=e.srcObject,console.log("[PiP] Stream attached to PiP video"),console.log("[PiP] Video will autoplay (muted initially for browser policy)");let c=!0;i.addEventListener("click",()=>{if(!e.srcObject){console.warn("[PiP] Remote stream no longer available");return}c=!c,n.muted=c,c?e.muted=!1:e.muted=!0,i.textContent=c?"Unmute Partner":"Mute Partner",i.style.background=c?"#ff9800":"#4caf50",console.log("[PiP] Partner audio in PiP window:",c?"MUTED":"UNMUTED")}),d.addEventListener("pagehide",()=>{console.log("[PiP] Document PiP window closed by user or browser"),d=null,t.textContent="Float Partner Video"}),d.addEventListener("load",()=>{console.log("[PiP] Document PiP window loaded event fired")}),n.addEventListener("error",p=>{console.error("[PiP] Video element error:",p)}),n.addEventListener("loadedmetadata",()=>{console.log("[PiP] Video metadata loaded in PiP window")}),t.textContent="Close Float Window",console.log("[PiP] Document PiP setup complete")}catch(n){throw console.error("[PiP] Error during Document PiP setup:",n),d&&(d.close(),d=null),n}}async function qe(e,t){document.pictureInPictureElement?(console.log("[PiP] Exiting native PiP"),await document.exitPictureInPicture(),I=!1,t.textContent="Float Partner Video"):(console.log("[PiP] Entering native PiP"),await e.requestPictureInPicture(),I=!0,t.textContent="Exit Float Mode")}function Ge(e,t){e.addEventListener("enterpictureinpicture",()=>{console.log("[PiP] Remote video entered native PiP (via browser controls)"),I=!0,t.textContent="Exit Float Mode"}),e.addEventListener("leavepictureinpicture",()=>{console.log("[PiP] Remote video exited native PiP (via browser controls)"),I=!1,t.textContent="Float Partner Video"})}function Ye(e){console.log("[PiP] Cleanup requested"),d&&(console.log("[PiP] Closing Document PiP window during cleanup"),d.close(),d=null),I&&document.pictureInPictureElement&&(console.log("[PiP] Exiting native PiP during cleanup"),document.exitPictureInPicture().catch(t=>{console.warn("[PiP] Failed to exit native PiP:",t)}),I=!1),e&&(e.textContent="Float Partner Video",e.style.display="none"),console.log("[PiP] Cleanup complete")}let Z=null,ee=!1;function j(e){return/(?:youtu.be\/|youtube.com\/(?:watch\?v=|embed\/|v\/))([\w-]{11})/.test(e)}function le(e){const t=e.match(/(?:youtu.be\/|youtube.com\/(?:watch\?v=|embed\/|v\/))([\w-]{11})/);return t?t[1]:null}function de(e,t,n){t.style.display="none";const i=document.getElementById("yt-iframe");i&&i.remove();let o=document.getElementById("yt-player-div");o||(o=document.createElement("div"),o.id="yt-player-div",t.parentNode.insertBefore(o,t)),o.innerHTML='<div id="yt-iframe"></div>',o.style.display="",Z=new YT.Player("yt-iframe",{height:"360",width:"640",videoId:e,events:{onReady:()=>{ee=!0},onStateChange:n}})}function ue(e){const t=document.getElementById("yt-player-div");t&&(t.style.display="none"),e.style.display="",Z=null,ee=!1}function z(){return Z}function K(){return ee}function We(){return!!(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)}async function Je(){return We()?(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"):[]}async function He(){const e=await Je();let t=!1,n=!1;return e.forEach(i=>{const o=i.label.toLowerCase();o.includes("front")&&(t=!0),(o.includes("back")||o.includes("rear")||o.includes("environment"))&&(n=!0)}),t&&n}async function _e({localStream:e,currentFacingMode:t,localVideo:n,peerConnection:i}){const o=t==="user"?"environment":"user";e.getVideoTracks().forEach(p=>p.stop());const c=(await navigator.mediaDevices.getUserMedia({video:{facingMode:o},audio:!0})).getVideoTracks()[0];if(e.removeTrack(e.getVideoTracks()[0]),e.addTrack(c),n.srcObject=e,i){const p=i.getSenders().find(C=>C.track&&C.track.kind==="video");p&&p.replaceTrack(c)}return o}function ze({urlRoomId:e,savedState:t}){const n=e||t?.roomId;if(!n)return{action:"idle"};const i=t?.roomId===n,o=t?.wasConnected===!0;return i&&o?{action:"reconnect",roomId:n}:{action:"join",roomId:n}}const A={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};let y,a,r=null,x=!1,h=!1,v=!1,k=!0,L="user",R=!1,P=!1;function T(){Se({roomId:r,isInitiator:h,isAudioMuted:v,isVideoOn:k,currentFacingMode:L,watchMode:R,wasConnected:x,streamUrl:w.value})}async function Ke(){console.log("🚀 init() called");try{y=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),b.srcObject=y,M.style.display="block",F.style.display="block",await He()?Y.style.display="block":Y.style.display="none",je({startChatBtn:S,hangUpBtn:V,copyLinkBtn:H,switchCameraBtn:Y,toggleMuteBtn:M,toggleVideoBtn:F,toggleModeBtn:B,loadStreamBtn:be,pipBtn:D,remoteVideo:f,handleStartChat:Qe,handleHangUp:et,handleCopyLink:nt,handleSwitchCamera:async()=>{L=await _e({localStream:y,currentFacingMode:L,localVideo:b,peerConnection:a}),T()},handleToggleMute:N,handleToggleVideo:W,handleToggleMode:J,handleLoadStream:ot,handlePipToggle:()=>Ae(f,D,g),updateStatus:g});const t=new URLSearchParams(window.location.search).get("room"),n=Le();console.log("📦 savedState:",n);const i=ze({urlRoomId:t,savedState:n});r=i.roomId,i.action==="reconnect"?(g("Connecting..."),S.style.display="none",n&&(v=n.isAudioMuted,k=n.isVideoOn,L=n.currentFacingMode,h=n.isInitiator,R=n.watchMode||!1,x=n.wasConnected||!1,k||W(),v&&N()),console.log("🔄 Calling handleReconnection"),await Xe(),n?.watchMode&&!R&&(J(),n.streamUrl&&(w.value=n.streamUrl))):i.action==="join"?(g("Connecting..."),S.style.display="none",n&&(v=n.isAudioMuted,k=n.isVideoOn,L=n.currentFacingMode,h=n.isInitiator,R=n.watchMode||!1,x=n.wasConnected||!1,k||W(),v&&N()),console.log("🆕 Calling joinChatRoom"),await Ze(r),n?.watchMode&&!R&&(J(),n.streamUrl&&(w.value=n.streamUrl))):g("Ready. Click to generate video chat link.")}catch(e){let t="Error: Could not access camera/mic.";e.name==="NotAllowedError"?t+=" Permission denied. Please allow access to your camera and microphone.":e.name==="NotFoundError"||e.name==="DevicesNotFoundError"?t+=" No camera or microphone found on this device.":e.name==="NotReadableError"||e.name==="TrackStartError"?t+=" Camera or microphone is already in use by another application.":e.name==="OverconstrainedError"||e.name==="ConstraintNotSatisfiedError"?t+=" The requested media device is not available or does not support the requested constraints.":e.name==="NotSupportedError"?t+=" Your browser or device does not support video/audio capture, or HTTPS is required.":t+=" "+e.message,console.error("Media error:",t,e),g(t)}}function $(e){f.srcObject!==e.streams[0]&&(f.srcObject=e.streams[0],D.style.display="block",Ge(f,D),x=!0,T(),g("Connected!"),f.paused&&f.srcObject&&f.play().catch(t=>{}))}async function te(){if(g("Partner reconnecting..."),me(),a&&(a.close(),a=null),f.srcObject&&(f.srcObject=null),h)await fe();else{g("Waiting for partner to reconnect...");const e=m.ref(`rooms/${r}`);e.child("offer").on("value",async n=>{await ie(n),e.child("offer").off("value")});const t=await e.child("offer").once("value");t.val()&&await ie(t)}}async function ie(e){const t=e.val();if(console.log("[RECONN-DEBUG] Joiner received offer snapshot:",t),!t)return;a=new RTCPeerConnection(A),y.getTracks().forEach(i=>{a.addTrack(i,y)}),console.log("[DEBUG] Assigning peerConnection.ontrack in handleOfferSnapshot"),a.ontrack=$,a.onicecandidate=i=>{i.candidate&&m.ref(`rooms/${r}/callerCandidates`).push(i.candidate.toJSON())},await a.setRemoteDescription(new RTCSessionDescription(t));const n=await a.createAnswer();await a.setLocalDescription(n),console.log("[RECONN-DEBUG] Joiner setting answer in Firebase:",{type:n.type,sdp:n.sdp}),await m.ref(`rooms/${r}/answer`).set({type:n.type,sdp:n.sdp}),console.log("[RECONN-DEBUG] Joiner set answer in Firebase."),m.ref(`rooms/${r}/callerCandidates`).on("child_added",i=>{const o=i.val();a.addIceCandidate(new RTCIceCandidate(o))}),await O(r,"joiner","connected")}async function Xe(){if(console.log("🔄 handleReconnection started, isInitiator:",h,"roomId:",r),!r){console.error("No roomId found for reconnection"),g("Error: No room ID found for reconnection.");return}const e=h?"initiator":"joiner";g("Reconnecting..."),await O(r,e,"reconnecting"),await new Promise(n=>setTimeout(n,1e3));const t=m.ref(`rooms/${r}`);h?(await t.child("answer").remove(),await t.child("calleeCandidates").remove()):(await t.child("callerCandidates").remove(),await t.child("offer").remove()),h&&await fe()}async function fe(){a=new RTCPeerConnection(A),y.getTracks().forEach(i=>{a.addTrack(i,y)}),console.log("[DEBUG] Assigning peerConnection.ontrack in createNewOffer"),a.ontrack=$;const e=m.ref(`rooms/${r}`);a.onicecandidate=i=>{i.candidate&&e.child("callerCandidates").push(i.candidate.toJSON())};const t=await a.createOffer();await a.setLocalDescription(t),await e.child("offer").set(t),console.log("[RECONN-DEBUG] Initiator attaching answer listener at path:",e.child("answer").toString()),e.child("answer").on("value",async i=>{const o=i.val();console.log("[RECONN-DEBUG] Initiator received answer snapshot:",o),o&&!a.currentRemoteDescription&&(await a.setRemoteDescription(new RTCSessionDescription(o)),console.log("[RECONN-DEBUG] Initiator set remote description with answer."))});const n=await e.child("answer").once("value");console.log("[RECONN-DEBUG] Initiator immediate read-back answer from Firebase:",n.val()),setTimeout(async()=>{const i=await e.child("answer").once("value");console.log("[RECONN-DEBUG] Initiator delayed (2s) read-back answer from Firebase:",i.val())},2e3),e.child("calleeCandidates").on("child_added",i=>{const o=i.val();a.addIceCandidate(new RTCIceCandidate(o))}),await O(r,"initiator","connected"),Q(r,"initiator",te),g("Reconnected! Waiting for partner...")}async function Qe(){h=!0,r||(r=tt()),a=new RTCPeerConnection(A),y.getTracks().forEach(o=>{a.addTrack(o,y)});const e=await a.createOffer();await a.setLocalDescription(e);const t=await xe(r,e);console.log("[DEBUG] Assigning peerConnection.ontrack in initiateChatRoom"),a.ontrack=$,a.onicecandidate=o=>{o.candidate&&t.child("callerCandidates").push(o.candidate.toJSON())},t.child("answer").on("value",async o=>{const s=o.val();s&&!a.currentRemoteDescription&&await a.setRemoteDescription(new RTCSessionDescription(s))}),t.child("calleeCandidates").on("child_added",o=>{const s=o.val();a.addIceCandidate(new RTCIceCandidate(s))});const n=`${window.location.origin}${window.location.pathname}?room=${r}`;U.value=n,ae.style.display="block",S.disabled=!0,V.disabled=!1,ge(),B.style.display="block";const i="initiator";O(r,i,"connected"),Q(r,i,te),T(),g("Link ready! Waiting for partner...")}async function Ze(e){const{roomRef:t,roomSnapshot:n}=await Be(e);if(!n.exists()){g("Error: Invalid room link");return}a=new RTCPeerConnection(A),y.getTracks().forEach(c=>{a.addTrack(c,y)}),console.log("[DEBUG] Assigning peerConnection.ontrack in joinChatRoom"),a.ontrack=$,a.onicecandidate=c=>{c.candidate&&t.child("calleeCandidates").push(c.candidate.toJSON())};const i=n.val().offer;await a.setRemoteDescription(new RTCSessionDescription(i));const o=await a.createAnswer();await a.setLocalDescription(o),await t.child("answer").set({type:o.type,sdp:o.sdp}),t.child("callerCandidates").on("child_added",c=>{const p=c.val();a.addIceCandidate(new RTCIceCandidate(p))}),ge(),B.style.display="block",V.disabled=!1;const s="joiner";O(e,s,"connected"),Q(e,s,te),T()}async function et(){Ye(D),me(),a&&(a.close(),a=null),f.srcObject&&(f.srcObject.getTracks().forEach(e=>e.stop()),f.srcObject=null),r&&h&&await Oe(r),r=null,h=!1,S.disabled=!1,S.style.display="block",V.disabled=!0,ae.style.display="none",M.style.display="none",F.style.display="none",B.style.display="none",re.style.display="none",se.style.display="flex",U.value="",l.src="",w.value="",u.textContent="",R=!1,v=!1,k=!0,x=!1,window.history.replaceState({},document.title,window.location.pathname),_(),g("Disconnected. Ready for new chat.")}function tt(){return Math.random().toString(36).substring(2,15)}function me(){if(!r)return;const e=m.ref(`rooms/${r}`);e.child("answer").off(),e.child("offer").off(),e.child("callerCandidates").off(),e.child("calleeCandidates").off()}async function nt(){try{await navigator.clipboard.writeText(U.value),H.textContent="Copied!",setTimeout(()=>H.textContent="Copy Link",2e3)}catch{U.select(),document.execCommand("copy")}}function g(e){Ne(ke,e)}function N(){v=Me(y,M,v);const e=ce.querySelector("i");e&&(e.className=v?"fa fa-volume-mute":"fa fa-volume-up"),T()}function W(){k=Fe(y,F,k),T()}function J(){R=Ue(R,se,re,B,l,w,u),T()}function ot(){const e=w.value.trim();if(!e){u.textContent="Please enter a stream URL";return}if(j(e)){const t=le(e);de(t,l,pe),u.textContent="YouTube video sent to partner..."}else ue(l),l.src=e,u.textContent="Video sent to partner...";r&&m.ref(`rooms/${r}/stream`).set({url:e}),T()}function pe(e){const t=z(),n=K();!r||!n||!t||(e.data===YT.PlayerState.PLAYING?m.ref(`rooms/${r}/stream`).update({playing:!0,time:t.getCurrentTime()}):e.data===YT.PlayerState.PAUSED&&m.ref(`rooms/${r}/stream`).update({playing:!1,time:t.getCurrentTime()}))}function it(){const e=w.value;if(j(e)){const t=le(e);de(t,l,pe),u.textContent="Loading YouTube video..."}else ue(l),l.src=e,u.textContent="Loading shared video...";u.style.background="#2a2a2a"}function ge(){if(!r)return;const e=m.ref(`rooms/${r}`);e.child("stream/url").on("value",t=>{const n=t.val();n&&n!==w.value&&(w.value=n,u.innerHTML='Partner shared a video: <button id="accept-shared-video" style="margin-left: 10px; padding: 5px 15px;">✓ Accept & Load</button>',document.getElementById("accept-shared-video").addEventListener("click",it),u.style.background="#2196f3")}),e.child("stream/playing").on("value",async t=>{if(P)return;const n=t.val(),i=w.value,o=z(),s=K();if(j(i)&&o&&s)n===!0&&o.getPlayerState()!==YT.PlayerState.PLAYING?(o.playVideo(),u.textContent="Playing in sync"):n===!1&&o.getPlayerState()===YT.PlayerState.PLAYING&&(o.pauseVideo(),u.textContent="Partner pressed pause");else if(n===!0&&l.paused)try{await l.play(),u.textContent="Playing in sync"}catch{u.textContent="▶️ Tap the video to start playing",u.style.background="#FF5722",u.style.fontSize="16px";const p=()=>{u.style.background="#2a2a2a",u.style.fontSize="14px",l.removeEventListener("play",p)};l.addEventListener("play",p)}else n===!1&&!l.paused&&(l.pause(),u.textContent="Partner pressed pause")}),e.child("stream/time").on("value",t=>{if(P)return;const n=t.val(),i=w.value,o=z(),s=K();j(i)&&o&&s?n!==null&&Math.abs(o.getCurrentTime()-n)>2&&(o.seekTo(n,!0),u.textContent=`Syncing to ${Math.floor(n)}s`):n!==null&&Math.abs(l.currentTime-n)>2&&(l.currentTime=n,u.textContent=`Syncing to ${Math.floor(n)}s`)}),l.addEventListener("play",()=>{r&&!P&&(P=!0,m.ref(`rooms/${r}/stream`).update({playing:!0,time:l.currentTime}),setTimeout(()=>P=!1,1e3))}),l.addEventListener("pause",()=>{r&&!P&&(P=!0,m.ref(`rooms/${r}/stream`).update({playing:!1,time:l.currentTime}),setTimeout(()=>P=!1,1e3))}),l.addEventListener("seeked",()=>{r&&!P&&(P=!0,m.ref(`rooms/${r}/stream`).update({time:l.currentTime}),setTimeout(()=>P=!1,1e3))}),l.addEventListener("loadeddata",()=>{u.textContent="Video loaded! Press play to start."}),l.addEventListener("waiting",()=>{u.textContent="Buffering..."}),l.addEventListener("playing",()=>{u.textContent="Playing in sync"})}Re?.addEventListener("click",()=>{f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen?f.webkitRequestFullscreen():f.msRequestFullscreen&&f.msRequestFullscreen()});Te?.addEventListener("click",()=>{b.requestFullscreen?b.requestFullscreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen()});ce?.addEventListener("click",()=>N());oe?.addEventListener("click",()=>{const e=f.srcObject?.getAudioTracks()[0];if(e){e.enabled=!e.enabled;const t=oe.querySelector("i");t&&(t.className=e.enabled?"fa fa-volume-mute":"fa fa-volume-up")}});Ke();
