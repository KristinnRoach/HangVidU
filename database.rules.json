{
  "rules": {
    "rooms": {
      "$roomId": {
        ".read": true,
        ".write": true
      }
    },
    "usersByEmail": {
      "$emailHash": {
        ".read": "auth != null",
        ".write": "auth != null && newData.child('uid').val() === auth.uid"
      }
    },
    "users": {
      "$userId": {
        "contacts": {
          ".read": "$userId === auth.uid",
          ".write": "$userId === auth.uid"
        },
        "incomingInvites": {
          ".read": "$userId === auth.uid",
          "$fromUserId": {
            ".write": "auth != null && (($fromUserId === auth.uid && !data.exists()) || ($userId === auth.uid && !newData.exists()))"
          }
        },
        "acceptedInvites": {
          ".read": "$userId === auth.uid",
          "$acceptedByUserId": {
            ".write": "auth != null && (($acceptedByUserId === auth.uid && !data.exists()) || ($userId === auth.uid && !newData.exists()))"
          }
        },
        "callHistory": {
          ".read": "$userId === auth.uid",
          ".write": "$userId === auth.uid"
        },
        "recentCalls": {
          ".read": "$userId === auth.uid",
          ".write": "$userId === auth.uid"
        },
        "outgoingCall": {
          ".read": "$userId === auth.uid",
          ".write": "$userId === auth.uid"
        },
        "presence": {
          ".read": true,
          ".write": "$userId === auth.uid"
        }
      }
    },
    "conversations": {
      "$conversationId": {
        ".read": "auth != null && ($conversationId.contains(auth.uid + '_') || $conversationId.contains('_' + auth.uid))",
        "messages": {
          "$messageId": {
            ".write": "auth != null && ($conversationId.contains(auth.uid + '_') || $conversationId.contains('_' + auth.uid))"
          }
        }
      }
    }
  }
}
